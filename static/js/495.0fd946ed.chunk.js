"use strict";(globalThis.webpackChunkjira_assistant=globalThis.webpackChunkjira_assistant||[]).push([[495],{6328:(e,t,r)=>{r.d(t,{A:()=>i});r(9950);var n=r(3410),a=r(787),s=r(4414);class o extends n.A{constructor(e){super(e,"Save Report As"),this.nameChanged=e=>this.setState({newQueryName:e}),this.copyChanged=e=>this.setState({copyQuery:e}),this.done=()=>{const{newQueryName:e,copyQuery:t}=this.state;this.props.onChange(e,t)},this.style={width:"350px"},this.state={showDialog:!0,newQueryName:e.queryName||"",copyQuery:!1}}getFooter(){const{state:{newQueryName:e}}=this;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.$n,{text:!0,type:"secondary",label:"Cancel",onClick:this.onHide}),(0,s.jsx)(a.$n,{type:"primary",icon:"fa fa-save",label:"Save",disabled:!e||e.length<3,onClick:this.done})]})}render(){const{props:{allowCopy:e},state:{newQueryName:t,copyQuery:r}}=this;return super.renderBase((0,s.jsxs)("div",{className:"pad-15",children:[(0,s.jsx)("label",{children:"Report Name"}),(0,s.jsx)("div",{children:(0,s.jsx)(a.fI,{value:t,onChange:this.nameChanged,style:{width:"100%"}})}),e&&(0,s.jsx)("div",{children:(0,s.jsx)(a.Sc,{checked:r,onChange:this.copyChanged,label:"Save as new report"})})]}))}}const i=o},4401:(e,t,r)=>{r.d(t,{A:()=>y});var n=r(9950),a=r(3151),s=r(4967),o=r(787),i=r(8738),l=r.n(i),c=r(8017),u=r(4353),d=r(374),p=r(2285),m=r(6524),f=r(4922),h=(r(4432),r(4414));const y=function(e){const{title:t,iconClass:r,hideRefresh:i,gadgetHint:u,hideMenu:d,isLoading:f,customActions:y,onRefresh:v,settings:x}=e,b=n.useRef({}),w=!1!==e.isGadget,j=x||{fullWidth:!1,fullHeight:!1},[k,N]=(0,n.useState)(j.fullWidth||!1),[S,C]=(0,n.useState)(j.fullHeight||!1),[T,A]=(0,n.useState)(!1),F=n.useId();(0,n.useEffect)((()=>{x&&(N(x.fullWidth),C(x.fullHeight))}),[x]);const{$analytics:E}=(0,m.WQ)("AnalyticsService"),P=()=>{A(!T),T?document.body.classList.remove("fs-layout"):document.body.classList.add("fs-layout")},$=(t,r)=>{e.onAction&&e.onAction({type:t,data:r},e.model,e.index)};b.current.props=e,b.current.isGadget=w,b.current.fullWidth=k,b.current.fullHeight=S,b.current.isFullScreen=T,b.current.$analytics=E,b.current.setSizeOptions=(e,t)=>{j.fullWidth=e,j.fullHeight=t,N(e),C(t),I()},b.current.toggleFullScreen=P,b.current.performAction=$;const I=()=>{$(p.v.SettingsChanged,j)},R=e=>(0,c.O0)(e,g(b.current)),L=n.useCallback((e=>(0,c.O0)(e,g(b.current))),[]),{children:G,tabLayout:D,gadgetType:M}=e;if(D)return(0,h.jsx)(h.Fragment,{children:G});const O=k||!w,_=S||!w,q=l()("gadget",e.className,{docked:!w,"full-width":O&&!T,"full-height":_&&!T,"half-width":!O&&!T,"half-height":!_&&!T,"full-screen":T});return(0,h.jsxs)("div",{ref:t=>{b.current.rootEl=t;const{dropProps:{dropConnector:r}={}}=e;r&&r(t)},className:q,"data-test-id":M,children:[f&&(0,h.jsx)(o.aH,{}),(0,h.jsx)(a.Panel,{header:(()=>{const{subTitle:n,draggableHandle:a}=e,l="gadget-header"+(a?" movable":"");return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)("div",{ref:a,className:l,onContextMenu:w?R:null,onDoubleClick:P,children:[(0,h.jsx)("i",{className:`fa ${r}`})," ",t," ",n&&(0,h.jsxs)("span",{children:[" - ",n]}),(0,h.jsxs)("div",{className:"float-end",children:[u?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(s.m,{target:`.icon-hint-${F}`,children:u}),(0,h.jsx)("i",{className:`fa fa-info-circle icon-hint icon-hint-${F}`,"data-pr-position":"bottom"})]}):null,y,!i&&(0,h.jsx)(o.$n,{text:!0,icon:"fa fa-refresh",disabled:f,onClick:c||v,title:"Refresh data"}),!d&&(0,h.jsx)(o.$n,{text:!0,icon:"fa fa-wrench",onClick:L})]})]}),(0,h.jsx)("div",{className:"clearfix"})]});var c})(),children:G})]})};function g(e){const{$analytics:t,performAction:r,isGadget:n,isFullScreen:a,fullWidth:s,fullHeight:o,rootEl:i,setSizeOptions:l,toggleFullScreen:c,props:{title:u,hideExport:m,hideCSVExport:h,hideXLSXExport:y,hidePDFExport:g}}=e,x=n?[{separator:!0},{label:"Full width",icon:`fa fa-${s?"check-":""}circle fs-16 margin-r-5`,command:()=>l(!s,o)},{label:"Full height",icon:`fa fa-${o?"check-":""}circle fs-16 margin-r-5`,command:()=>l(s,!o)},{separator:!0},{label:"Remove",icon:"fa fa-remove",command:()=>{t.trackEvent("Gadget removed",f.hB.GadgetActions,u),r(p.v.RemoveGadget)}}]:[],b=[];return m||(b.push({separator:!0}),h||b.push({label:"Export to CSV",icon:"fa fa-file-text",command:()=>v(d.A.CSV,u,i,t)}),y||b.push({label:"Export to Excel",icon:"fa fa-file-excel",command:()=>v(d.A.XLSX,u,i,t)}),g||b.push({label:"Export to PDF",icon:"fa fa-file-pdf",command:()=>v(d.A.PDF,u,i,t)})),[{label:"Toggle full screen",icon:"fa fa-"+(a?"compress":"expand"),command:()=>c()},...b,...x]}function v(e,t,r,n){const a=new u.L;a.fileName=t,a.format=e||e,a.element=r,n.trackEvent("Export data",f.hB.GadgetActions,a.format),a.export()}},9109:(e,t,r)=>{r.d(t,{A:()=>i});r(9950);var n=r(8738),a=r.n(n),s=r(787),o=r(4414);const i=function({title:e,onBackClick:t,show:r,onHide:n,children:i,contentClassName:l,controls:c}){return(0,o.jsx)("div",{className:"side-bar-container "+(r?"open":"closed"),children:(0,o.jsxs)("div",{className:"site-bar-block",children:[(0,o.jsxs)("div",{className:"header"+(t?" ps-0":""),children:[(0,o.jsx)(s.$n,{className:"close-icon",icon:"fa fa-times",onClick:n,title:"Hide this block"}),c,t&&(0,o.jsx)(s.$n,{className:"back-icon float-start",icon:"fa fa-arrow-left",onClick:t,title:"Configure data source"}),(0,o.jsx)("h2",{className:"title",children:e})]}),(0,o.jsx)("div",{className:a()("site-bar-content",l),children:i})]})})}},6495:(e,t,r)=>{r.r(t),r.d(t,{default:()=>sr});var n={};r.r(n),r.d(n,{as_date:()=>Se,avg:()=>Pe,currentUser:()=>je,date_diff:()=>Fe,first:()=>Re,last:()=>Le,max:()=>Ie,min:()=>$e,now:()=>Ae,parameters:()=>ke,sum:()=>Ee,today:()=>Ce,todayEOD:()=>Te});var a=r(9950),s=r(8429),o=r(8807),i=r(787),l=r(4401),c=r(8222),u=r(1219),d=r(8766);const p=(0,d.v)((()=>({showParameters:!1,isFetching:!1}))),m=(0,d.v)((e=>({searchText:"",setSearchText:t=>e({searchText:t})}))),f=(0,d.v)((()=>({queryName:"New Report",reportType:"pivot",dataSourceType:1,jql:"",fields:[]}))),h=(0,d.v)((e=>({itemPath:null,level:0,selectItem:(t,r)=>e({itemPath:t,level:r})})));function y(e,t,{args:{itemPath:r}}){const n=f.getState(),a=(0,c.d)(n,r,e),{fields:s}=a;f.setState({fields:s})}function g(e={}){f.setState({parameters:e})}function v(e){f.setState((()=>({jql:e})))}function x(e){f.setState((()=>({dataSourceType:e||1})))}function b(e){const{id:t,key:r,name:n,schema:a}=e;return{id:t,key:r,name:n,schema:a}}function w(e={}){const{jql:t,fields:r}=f.getState();return j(e,r),{jql:t,fields:Object.keys(e)}}function j(e,t){t&&t.forEach((t=>{var r;null!==(r=t.schema)&&void 0!==r&&r.derived&&t.key.includes(".")?e[t.key.split(".")[0]]=!0:t.key&&(e[t.key]=!0),j(e,t.subItems)}))}var k=r(6524),N=r(6904);const S=[{label:"Default",value:"DT_DF",props:void 0,type:"datetime"},{label:"Date only",value:"DT_DO",props:{dateOnly:!0},type:"datetime"},{label:"Age in days (words)",value:"DT_AG",props:{quick:!0},type:"datetime"},{label:"Age in days (number)",value:"DT_NM",props:{format:"num"},type:"datetime"},{label:"Issue Key with Status",value:"PT_KY_ST",props:{settings:{showStatus:!0}},type:"parent"},{label:"Issue Key only",value:"PT_KY",props:{settings:{showStatus:!1}},type:"parent"},{label:"Summary only",value:"PT_SM",props:{settings:{valueType:"summary",showStatus:!1}},type:"parent"},{label:"Summary with Status",value:"PT_SM_ST",props:{settings:{valueType:"summary",showStatus:!0}},type:"parent"},{label:"Both Key & Summary",value:"PT_BT",props:{settings:{valueType:"both",showStatus:!1}},type:"parent"},{label:"Key, Summary & Status",value:"PT_BT_ST",props:{settings:{valueType:"both",showStatus:!0}},type:"parent"},{label:"Key only",value:"PR_KY",props:{settings:{}},type:"project"},{label:"Name only",value:"PR_NM",props:{settings:{valueType:"name"}},type:"project"},{label:"Both Key & Name",value:"PR_BT",props:{settings:{valueType:"both"}},type:"project"},{label:"Formatted",value:"TS_FR",props:{format:!0},type:"timespent"},{label:"As Number",value:"TS_NM",props:{format:!1},type:"timespent"},{label:"Name only",value:"USR_NM",props:{settings:{showImage:!1}},type:"user"},{label:"Name with Image",value:"USR_NM_IMG",props:{settings:{showImage:!0}},type:"user"},{label:"Email only",value:"USR_EM",props:{settings:{valueType:"email",showImage:!1}},type:"user"},{label:"Email with Image",value:"USR_EM_IMG",props:{settings:{valueType:"email",showImage:!0}},type:"user"},{label:"Name & Email",value:"USR_BT",props:{settings:{valueType:"both",showImage:!1}},type:"user"},{label:"Name, Email & Image",value:"USR_BT_IMG",props:{settings:{valueType:"both",showImage:!0}},type:"user"}],C=S.reduce(((e,t)=>(e[t.value]=t.props,e)),{}),T=S.groupBy((e=>e.type)).reduce(((e,{key:t,values:r})=>(e[t]=r,e)),{});function A(e){const{schema:{type:t},format:r}=e,n=(0,N.vL)(t),a=r&&C[r];return a&&(n.props=a),{renderer:n}}function F(e){const{keyField:t}=(0,N.AZ)(e),{key:r}=e;return t?"function"===typeof t?e=>t(e[r]):t?e=>{var n;return null===(n=e[r])||void 0===n?void 0:n[t]}:e=>e[r]:e=>e[r]}function E(e,t){const{keyField:r}=(0,N.AZ)(e),{key:n}=e;return function(e,t,r){const n=n=>function(e,t){if(!t)return e;if("function"===typeof t)return t(e);if("string"===typeof t)return null===e||void 0===e?void 0:e[t];throw new Error("Key field is of unknown type: "+typeof t)}((0,c.h)(n,e),t)===r;return n}(n,r,t)}function P(e){return t=>t.key===e}T.date=T.datetime;var $=r(9093);const I="none",R=[{value:I,label:"No Aggregation",allowDistinct:!0},{value:"sum",label:"Sum",allowedFor:["number","timespent","date","datetime"]},{value:"avg",label:"Avg",allowedFor:["number","timespent","date","datetime"]},{value:"min",label:"Min",allowedFor:["number","timespent","date","datetime"]},{value:"max",label:"Max",allowedFor:["number","timespent","date","datetime"]},{value:"count",label:"Count",returnType:"number",allowDistinct:!0},{value:"merge",label:"Merge (CSV)",allowedFor:["string"]},{value:"first",label:"First value"},{value:"last",label:"Last value"}],L=R.filter((e=>e.allowDistinct)).map((e=>e.value));const G={count:function(e,t){return t.map((0,$.f)(e)).filter((e=>e||0===e)).length},merge:function(e,t){return t.map((0,$.f)(e)).join(", ")},first:function(e,t){return(0,c.h)(t[0],e)},last:function(e,t){return(0,c.h)(t.last(),e)}};function D(e){const{agrFunc:t="first"}=e;return!(!t||t===I)}function M(e,t){if(!D(e))return null;const{agrFunc:r="first"}=e,n=G[r];return n?n(e.key,t,e):t[r](e.key)}var O=r(9051),_=r.n(O),q=r(4414);const B=function(e){const{value:t,tagProps:r={}}=e;return t?(0,q.jsxs)("th",{"data-test-id":t.prop,className:"day-head"+(t.isHoliday?" holiday":""),...r,children:[t.dateNum,(0,q.jsx)("br",{}),(0,q.jsx)("span",{className:"day-name",children:t.day})]}):null};var Q=r(5587);function V(e,t,r,n,a,s){const[o,i]=s(r,t,a,n);return o&&(e.tagProps.colSpan=o),e.subItems=i,e}function U({date:e}){return{start:(e=_()(e)).startOf("day").valueOf(),end:e.endOf("day").valueOf()}}function W({start:e,end:t},r){if(r){if(r.includes(".")){const[n,a]=r.split(".");return r=>r.map((r=>{let s=r[n];return s?Array.isArray(s)&&(s=s.filter((r=>{const n=r[a];return!!n&&_()(n).isBetween(e,t,void 0,"[]")})),!s.length)?null:{...r,[n]:s}:null})).filter(Boolean)}return n=>n.filter((n=>{const a=n[r];return!!a&&_()(a).isBetween(e,t,void 0,"[]")}))}}function H(e,t,r,n,a,s){const o=J[e.schema.type];if(o)return o(e,t,r,n,a,s);throw new Error(`Unknown field error. Type:-${e.schema.type}`)}const J={"date-range":function(e,t,r,n,a,s){const{dateRange:o,rangeType:i="days",filterField:l,showTotal:c,showTotalFirst:u,subItems:d}=e,p=function(e,t){const{$userutils:r}=(0,k.WQ)("UserUtilsService");return(0,Q.uo)(e,t,r.isHoliday)}(o.fromDate,o.toDate),m=c&&{headerText:"Total",colGroup:!0,enableGrouping:!0,depth:n,tagProps:{rowSpan:2},transformFn:W({start:_()(o.fromDate).startOf("day"),end:_()(o.toDate).endOf("day")},l)};if("days"===i){const e=(0,Q.o_)(p),{header:a}=t,o=a[n],i=a[n+1];m&&u&&o.push(V(m,t,d,n+1,r,s));const c=e.map((e=>{const a={headerText:e.display,colGroup:!0,enableGrouping:!0,depth:n,tagProps:{colSpan:0},transformFn:W(e,l)};return o.push(a),a.subItems=e.values.map((e=>{const o={enableGrouping:!0,value:e,depth:n+1,tagProps:{},transformFn:W(U(e),l),renderer:{Component:B}};i.push(o);const[c,u]=s(d,t,r,n+1);return c?(o.tagProps.colSpan=c,a.tagProps.colSpan+=c):a.tagProps.colSpan+=1,o.subItems=u,o})),a}));return m&&!u&&o.push(V(m,t,d,n+1,r,s)),[p.length,c]}}};function z(e,t){if(!t.length)return;const{agrFunc:r="first",key:n}=e;if(!r)return null;let a=[];if(!n.includes("."))throw new Error("Unhandled Error: Error Code:- CF_NO_DOT");{const[e,r]=n.split(".");a=t.flatMap((t=>{const{[e]:n}=t;return n?Array.isArray(n)?n.map((({[r]:e})=>e)):[n[r]]:[]}))}const s=K[r];return s?s(a):a[r]()}const K={count:function(e){return e.filter((e=>e||0===e)).length},merge:function(e){return e.join(", ")},first:function(e){return e[0]},last:function(e){return e.last()}};function Z(e,t){const[r,...n]=t;return r.preGroupFilter&&(e=r.preGroupFilter(e)),r.colGroup?[Y(t,e)]:r.enableGrouping?function(e,t,r){return e.groupFn(t,((t,n)=>{const a={...e.cellProps,value:t};return r.length&&(a.subRows=Z(n,r)),a}))}(r,e,n):r.agrFunc?function(e,t,r){const n=re(e,t);r.length&&(n.subRows=Z(t,r));return[n]}(r,e,n):X(e,t)}function Y(e,t){let r=t,n=null,a=t,s=null;return e.flatMap((e=>(e.transformFn&&n!==e.transformFn&&t.length?(n=e.transformFn,r=n(t,e),a=r):e.transformFn||(r=t),e.colGroupFn&&s!==e.colGroupFn?(s=e.colGroupFn,a=s(r,((e,t,r)=>({key:r,values:t})))):e.colGroupFn||(a=r),function(e,t){var r;const n=e.groupFilterFn?(null===(r=t.filter(e.groupFilterFn)[0])||void 0===r?void 0:r.values)||[]:t;return te(e,n)}(e,a))))}function X(e,t){let r=null;const n=[];for(const a of e){const e=[];for(let s=0;s<t.length;s++){const o=t[s];if(o.enableGrouping){const r=t.slice(s);e[e.length-1].subRows=Z([a],r);break}const i=ee(o,a);if(Array.isArray(i)){if(o.colGroup){e.push(...i);continue}r||(r=t.slice(s));const a=X(i,r),l=e.length?e[e.length-1]:null;l?l.subRows=a:n.push(...a);break}e.push(i)}e.length&&n.push(e)}return n}function ee(e,t){const r=!e.issueFilterFn||e.issueFilterFn(t);return te(e,r?[t]:[])}function te(e,t){return e.enableGrouping&&e.subItems?Y(e.subItems,t).flat():e.colGroup?re(e,t):function(e,t){var r;if(null!==(r=e.schema)&&void 0!==r&&r.derived){const r=function(e,t){const{key:r}=e;if(r.includes(".")){const[e,n]=r.split(".");return t.flatMap((t=>{const{[e]:r}=t;return r?Array.isArray(r)?r.map((r=>({...t,[e]:[r]}))):[r[n]]:[]}))}throw new Error("Unhandled Error: Error Code:- DF_NO_DOT")}(e,t);return r.length?1===r.length?{...e.cellProps,value:z(e,r)}:r:{...e.cellProps,value:null}}return{...e.cellProps,value:M(e,t)}}(e,t)}function re(e,t){var r;const n=null!==(r=e.schema)&&void 0!==r&&r.derived?z(e,t):M(e,t);return{...e.cellProps,value:n}}function ne(e,t){Array.isArray(e)?function(e,t){e.forEach((e=>ae(e,t)))}(e,t):ae(e,t)}function ae(e,t){const{subRows:r,...n}=e,a=t.length,s=t[a-1],o=s.length;s.push(n),null!==r&&void 0!==r&&r.length&&r.forEach(((e,r)=>{r&&t.push([]),ne(e,t)}));const i=t.length-a+1;if(i>1&&(n.tagProps={rowSpan:i},o))for(let l=o-1;l>=0;l--){const e=s[l];e.tagProps?e.tagProps.rowSpan<i&&(e.tagProps.rowSpan=i):e.tagProps={rowSpan:i}}}var se=r(5529),oe=r.n(se);const ie="parameters",le=[{name:ie,parameters:[{paramName:"paramName",type:"string"}],returns:["any"]},{name:"sum",parameters:[{paramName:"values",type:["number","timespent"],array:!0}],returns:":values"},{name:"avg",parameters:[{paramName:"values",type:["number","timespent"],array:!0}],returns:":values"},{name:"min",parameters:[{paramName:"values",type:["number","timespent","date","datetime"],array:!0}],returns:":values"},{name:"max",parameters:[{paramName:"values",type:["number","timespent","date","datetime"],array:!0}],returns:":values"},{name:"first",parameters:[{paramName:"values",array:!0}],returns:":values"},{name:"last",parameters:[{paramName:"values",array:!0}],returns:":values"},{name:"as_date",parameters:[{paramName:"value",type:["number","date","datetime","string"]},{paramName:"format",type:["string"],optional:!0}],returns:"datetime"},{name:"today",parameters:[{paramName:"value",type:["number","string"],optional:!0}],returns:"datetime"},{name:"eod",parameters:[{paramName:"value",type:["datetime","number","string"],optional:!0}],returns:"datetime"},{name:"startOfDay",parameters:[{paramName:"value",type:["datetime","number","string"],optional:!0}],returns:"datetime"},{name:"now",parameters:[{paramName:"value",type:["number","string"],optional:!0}],returns:"datetime"},{name:"date_diff",parameters:[{paramName:"date1",type:"datetime"},{paramName:"date2",type:"datetime"},{paramName:"unit",type:"string",optional:!0}],returns:"number"},{name:"startDate",parameters:[{paramName:"date",type:"daterange"}],returns:"datetime"},{name:"endDate",parameters:[{paramName:"date",type:"daterange"}],returns:"datetime"},{name:"currentUser",parameters:[],returns:"user"}].reduce(((e,t)=>(e[t.name.toLowerCase()]=t,e)),{});function ce(e){var t,r,n;return null===(t=oe().parse(`select * from json where (${e})`).value)||void 0===t||null===(r=t.where)||void 0===r||null===(n=r.value)||void 0===n?void 0:n.value}function ue(e,t){try{return function(e,t){if(!e||"string"===typeof e||!Array.isArray(e))return{isValid:!1,errorMessage:"Query is incomplete"};try{const r=function(e,t){return e.forEach((e=>{if(!me[e.type])throw new Error("Query is incomplete. Missing comparison");de(e,t)})),t}(e,t);return{isValid:!0,json:e,result:r}}catch(r){return{errorMessage:r.message,json:e}}}(ce(e),t)}catch(r){return{isValid:!1,errorMessage:r.message}}}function de(e,t,r){const{type:n,operator:a}=e,s=fe[n];if(!s)throw new Error(`Usage of ${a||n} is unsupported`);return function(e){let t=(null===e||void 0===e?void 0:e.type)||e;if(!t)return e;Array.isArray(t)?(t=t.map((e=>pe[e]||e)).distinct(),t.length<2&&(t=t[0])):"string"===typeof t&&(t=pe[t]||t);if(!t)return e;if("object"===typeof e&&!Array.isArray(e))return{...e,type:t};return t}(s(e,t,r))}const pe={date:"datetime"};const me={AndExpression:he,OrExpression:he,ComparisonBooleanPrimary:function(e,t){const{left:r,right:n,operator:a}=e,s=de(r,t);if((a.includes("<")||a.includes(">"))&&!be(s,ye))throw new Error(`Incompatible types used with "${a}" comparer`);const o=de(n,t,{type:s});if(!be(s,o))throw new Error(`"${a}" comparison done between incompatible types`)},BetweenPredicate:function(e,t){const{left:r,right:{left:n,right:a}}=e,s=de(r,t);if(!be(s,ye))throw new Error("Incompatible types used with between predicate");const o=de(n,t,{type:s}),i=de(a,t,{type:s});if(!be(s,o)||!be(s,i)||!be(o,i))throw new Error("Between predicate used with in-compatible types")},LikePredicate:function(e,t){const{left:r,right:n}=e,a=de(r,t);if(be(a,ge))throw new Error("Like comparison is used with incompatible types");const{type:s,value:o}=n;if("string"!==s.toLowerCase())throw new Error("Only string is supported on right hand side of Like predicate");if(!["*",".","%","_"].some((e=>o.includes(e))))throw new Error("The string in right hand side of Like predicate doesn't contain any expressions and would never be met. Either use some expression or use other operators");if(o.replace(/[%.*]/g,"").length<3)throw new Error("The string in right hand side of Like predicate is too short. Either use some expression or use other operators");if(!be(de(n,t,{type:a}),["string"]))throw new Error("Like comparison done between incompatible types")},InExpressionListPredicate:function(e,t){const{left:r,right:n}=e,a=de(r,t);!function(e,t,r){const{value:n}=e;1===n.length&&(r={...r,isArray:!0});for(const a of n){const e=de(a,t,r);if(!be(r.type,e))throw new Error("List contains in-compatible types")}}(n,t,{type:a})}},fe={...me,Identifier:function(e,t){const{value:r}=e;let n=r.toLowerCase();n.startsWith("`")&&(n=n.substring(1,n.length-1));const a=t.fieldsMap[n];if(!a)throw new Error(`Unknown field ${r}`);return t.fields[n]=!0,a.schema},FunctionCall:function(e,t,r){const{name:n,params:a}=e,s=n.toLowerCase(),o=le[s];if(!o)throw new Error(`Unknown function ${n}`);let{returns:i}=o;const{parameters:l}=o,c=(null===l||void 0===l?void 0:l.length)||0;1===(null===a||void 0===a?void 0:a.length)&&null===a[0]&&a.splice(0,1);if((null===a||void 0===a?void 0:a.length)>c)throw new Error(`Expected ${(null===l||void 0===l?void 0:l.length)||0} arguments for function "${n}", but passed ${(null===a||void 0===a?void 0:a.length)||0}`);for(let u=0;u<c;u++){const e=l[u],r=a[u];if(!r&&!e.optional)throw new Error(`Missing arguments for function ${n}`);const s=de(r,t,e);if(!be(s,e.type))throw new Error(`Type mismatch for argument ${u+1} on ${n}`);i===`:${e.paramName}`&&(i=(null===s||void 0===s?void 0:s.type)||s)}if("string"===typeof i&&i.startsWith(":"))throw new Error(`Unknown return type ${i} for function ${n}`);return ve(s,a,t,r),i},Number:xe,String:xe,Boolean:xe,Null:xe};function he(e,t){const{left:r,right:n}=e;de(r,t),de(n,t)}const ye=["number","date","datetime","timespent"];const ge=["date","datetime","number","timespent"];function ve(e,t,r,n){if(e===ie){var a;const e=t[0],s=e.type.toLowerCase();if("string"!==s)throw new Error(`Parameter name must be a string, but passed ${s}`);const o=e.value.substring(1,e.value.length-1);if(o.length<5)throw new Error("Parameter name is too short");if(o.length>27)throw new Error("Parameter name is too big");const i=o.toLowerCase(),l=r.parameters[i];if(l&&!be(n.type,l.type))throw new Error(`Parameter ${e.value} is used across incompatible types`);r.parameters[i]={name:o,type:(null===(a=n.type)||void 0===a?void 0:a.type)||n.type,isArray:n.isArray||void 0}}}function xe(e){const{type:t}=e;return{type:t.toLowerCase()}}function be(e,t){return!(!e||!t)&&(e=we(e),t=we(t),!0===e||!0===t||e===t||("string"===e?!(!t.includes("string")&&t.includes("number")):"string"===t?!(!e.includes("string")&&e.includes("number")):e.some((e=>t.includes(e)))))}function we(e){if("object"===typeof e&&!Array.isArray(e)){const{type:t,compatibleTypes:r}=e;e=t,null!==r&&void 0!==r&&r.length&&(e=[...r,e])}if(!e||"null"===e||"any"===e)return!0;if("string"===e)return e;if(!Array.isArray(e)){if("any"===e)return!0;e=[e]}return!!e.includes("any")||e}function je(){var e;const{$session:t}=(0,k.WQ)("SessionService");return(0,u.J3)(null===(e=t.CurrentUser)||void 0===e?void 0:e.jiraUser)}function ke(e){var t;return Ne(null===(t=this.parameters[e.toLowerCase()])||void 0===t?void 0:t.value)}function Ne(e){return Array.isArray(e)?e.map(Ne):"string"===typeof e?e.toLowerCase():e}function Se(e,t){return _()(e,t).valueOf()}function Ce(e){return _()(Ae(e)).startOf("day").valueOf()}function Te(e){return _()(Ae(e)).endOf("day").valueOf()}function Ae(e){e=function(e){if(!isNaN(e))return{amount:parseFloat(e),unit:"days"};const t=new RegExp("^([+-])(\\d*)(y|Q|M|w|d|h|m)$","g").exec(e);if(!t)return null;const[,r,n,a]=t;return{amount:parseInt(r+n),unit:a}}(e);let t=_()();return e&&(t=t.add(e.amount,e.unit)),t.valueOf()}function Fe(e,t,r){_()(e).diff(t,r).valueOf()}function Ee(e){return 0}function Pe(e){return 0}function $e(e){return 0}function Ie(e){return 0}function Re(e){return null}function Le(e){return null}const Ge=(0,d.v)((()=>({fields:[],fieldsMap:{}})));async function De(){const e=await async function(){const{$jira:e}=(0,k.WQ)("JiraService"),t=function(e){return e.filter(Oe).map((e=>{const{id:t,key:r,name:n,custom:a}=e;let{schema:s}=e;return s||(s={type:r}),{id:t,key:r,name:n,custom:a,schema:s}})).orderBy((e=>e.name))}(await e.getCustomFields()),r=[],n=[],a={};t.forEach((e=>{let t=e.key.toLowerCase();if(a[t]&&e.id&&(t=e.id.toLowerCase()),a[t]=e,e.custom){const t=e.name.toLowerCase();a[t]||(a[t]=e),n.push(e)}else r.push(e)}));const s=[{id:"attachmentAuthor",key:"attachment.author",name:"Attachment Added By",schema:{type:"user",derived:!0,isArray:!0}},{id:"attachmentCreated",key:"attachment.created",name:"Attachment Added Time",schema:{type:"datetime",derived:!0,isArray:!0}},{id:"attachmentFileName",key:"attachment.filename",name:"Attachment File Name",schema:{type:"string",derived:!0,isArray:!0}},{id:"attachmentType",key:"attachment.mimeType",name:"Attachment Mime Type",schema:{type:"string",derived:!0,isArray:!0}},{id:"attachmentSize",key:"attachment.size",name:"Attachment Size",schema:{type:"size",derived:!0,isArray:!0}},{id:"commentAuthor",key:"comment.author",name:"Comment Added By",schema:{type:"user",derived:!0,isArray:!0}},{id:"commentCreated",key:"comment.created",name:"Comment Added Time",schema:{type:"datetime",derived:!0,isArray:!0}},{id:"commentBody",key:"comment.body",name:"Comment Body",schema:{type:"string",derived:!0,isArray:!0}},{id:"commentUpdateAuthor",key:"comment.updateAuthor",name:"Comment Updated By",schema:{type:"user",derived:!0,isArray:!0}},{id:"commentUpdated",key:"comment.updated",name:"Comment Updated Time",schema:{type:"datetime",derived:!0,isArray:!0}},{id:"componentsDescription",key:"components.description",name:"Component Description",schema:{type:"string",derived:!0,isArray:!0}},{id:"componentsName",key:"components.name",name:"Component Name",schema:{type:"string",derived:!0,isArray:!0}},{id:"dateRange",key:"",name:"Date Range",schema:{type:"date-range",computed:!0,depth:1}},{id:"fixVersionsArchived",key:"fixVersions.archived",name:"Fix Version Archived",schema:{type:"bool",derived:!0,isArray:!0}},{id:"fixVersionsName",key:"fixVersions.name",name:"Fix Version Name",schema:{type:"string",derived:!0,isArray:!0}},{id:"fixVersionsReleaseDate",key:"fixVersions.releaseDate",name:"Fix Version Release Date",schema:{type:"date",derived:!0,isArray:!0}},{id:"fixVersionsReleased",key:"fixVersions.released",name:"Fix Version Released",schema:{type:"bool",derived:!0,isArray:!0}},{id:"worklogAuthor",key:"worklog.author",name:"Worklog Added By",schema:{type:"user",derived:!0,isArray:!0}},{id:"worklogCreated",key:"worklog.created",name:"Worklog Added Time",schema:{type:"datetime",derived:!0,isArray:!0}},{id:"worklogComment",key:"worklog.comment",name:"Worklog Comment",schema:{type:"string",derived:!0,isArray:!0}},{id:"worklogTime",key:"worklog.started",name:"Worklog Time",schema:{type:"datetime",derived:!0,isArray:!0}},{id:"worklogTimespent",key:"worklog.timeSpentSeconds",name:"Worklog Time spent",schema:{type:"timespent",derived:!0,isArray:!0}},{id:"worklogUpdateAuthor",key:"worklog.updateAuthor",name:"Worklog Updated By",schema:{type:"user",derived:!0,isArray:!0}},{id:"worklogUpdated",key:"worklog.updated",name:"Worklog Updated Time",schema:{type:"datetime",derived:!0,isArray:!0}}].orderBy((e=>e.name));return s.forEach((e=>{let{key:t}=e;t&&(a[t]&&(t=e.id),a[t.toLowerCase()]=e)})),{native:r,custom:n,derived:s,fieldsMap:a}}();Ge.setState({fields:[{label:"Native",items:e.native},{label:"Custom",items:e.custom},{label:"Derived",items:e.derived}],fieldsMap:e.fieldsMap})}const Me=["worklog","comment","attachment"];function Oe(e){return!Me.includes(e.key)}const _e={parent:["key","id"],project:["name","key"],user:["displayName","emailAddress","name","accountId"]};const qe={parent:["key"],project:["name","key"],user:["displayName","emailAddress","name","accountId"]};const Be=Object.keys(n).reduce(((e,t)=>(e[t.toLowerCase()]=n[t],e)),{});function Qe(e){if(null===e||void 0===e||!e.trim())return;const{fieldsMap:t}=Ge.getState(),{parameters:r={}}=f.getState(),n={fieldsMap:t,parameters:r},a=ce(e);return e=>e.map(function(e,t){const r=e.map((e=>Ve(e,t)));return e=>r.reduce(((e,t)=>e&&t(e)),e)}(a,n)).filter(Boolean)}function Ve(e,t){return(0,Ue[e.type])(e,t)}const Ue={AndExpression:We,OrExpression:We,ComparisonBooleanPrimary:function(e,t){const{left:r,right:n,operator:a}=e,s=Ve(r,t),o=Ve(n,t);let i;i=s.returnsArrayOfValues?He(a,s,o):o.returnsArrayOfValues?He(a,o,s):function(e,t,r){switch(e){case"=":return e=>t(e)===r(e);case"!=":case"<>":return e=>t(e)!==r(e);case">":return e=>t(e)>r(e);case">=":return e=>t(e)>=r(e);case"<":return e=>t(e)<r(e);case"<=":return e=>t(e)<=r(e)}}(a,s,o);return e=>e&&i(e)?e:void 0},BetweenPredicate:function(e,t){const{left:r,right:{left:n,right:a}}=e,s=Ve(r,t),o=Ve(n,t),i=Ve(a,t);return e=>{const t=s(e);return t>=o(e)&&t<=i(e)}},InExpressionListPredicate:function(e,t){const{left:r,right:n,hasNot:a}=e,s=Ve(r,t);return function(e,t,r,n){var a;const{value:s}=e;let o=s.map((e=>Ve(e,t)));1===o.length&&"parameters"===(null===(a=s[0].name)||void 0===a?void 0:a.toLowerCase())&&"FunctionCall"===s[0].type&&(o=o[0]());return r.returnsArrayOfValues?e=>{const t=r(e);for(let r of o)if("function"===typeof r&&(r=r(e)),t.includes(r))return n?null:e;if(n)return e}:e=>{const t=r(e);for(const r of o)if(t===r(e))return n?null:e;if(n)return e}}(n,t,s,!!a)},LikePredicate:function(e,t){t={...t,isLikeComparison:!0};const{left:r,right:n,hasNot:a}=e,s=Ve(r,t);return function(e,t,r,n){let{value:a}=e;return a=a.substring(1,a.length-1),a=new RegExp(`^${a.replace(/%/g,".*").replace(/_/g,".")}$`,"im"),r.returnsArrayOfValues?e=>r(e).some((e=>a.test(e)))?n?null:e:n?e:void 0:e=>a.test(r(e))?n?null:e:n?e:void 0}(n,0,s,!!a)},Identifier:function(e,t){const{value:r}=e,n=r.toLowerCase(),a=t.fieldsMap[n],s=t.isLikeComparison?function(e){return(0,N.s2)(e,qe,"name")}(a):function(e){return(0,N.s2)(e,_e,["name","id"])}(a),{type:o,keyField:i}=s,l=a.key;let c=Je;"date"!==o&&"datetime"!==o||(c=ze);return i?Array.isArray(i)?(c=e=>{if(!e)return null;const t=e[l];return"object"!==typeof t?t:i.map((e=>{var r;return null!==(r=Je(t[e]))&&void 0!==r?r:{}}))},c.returnsArrayOfValues=!0,c):"function"===typeof i?e=>{const t=null===e||void 0===e?void 0:e[l];return t&&c(i(t))}:e=>{var t;return c(null===e||void 0===e||null===(t=e[l])||void 0===t?void 0:t[i])}:e=>c(null===e||void 0===e?void 0:e[l])},FunctionCall:function(e,t){const{name:r,params:n}=e,a=r.toLowerCase(),s=Be[a];1===(null===n||void 0===n?void 0:n.length)&&null===n[0]&&n.splice(0,1);const o=n.map((e=>Ve(e,t)));if(null!==o&&void 0!==o&&o.length&&o.some((e=>!e.isStaticValue)))return e=>e&&s.apply(t,o.map((t=>t(e))));{const e=s.apply(t,o.map((e=>e()))),r=()=>e;return s.isStaticValue=!0,r}},Number:Ke,String:Ke,Boolean:Ke,Null:Ke};function We(e,t){const{left:r,right:n,operator:a}=e,s=Ve(r,t),o=Ve(n,t);return"and"===a?e=>s(e)&&o(e):e=>s(e)||o(e)}function He(e,t,r){switch(e){case"=":return e=>t(e).includes(r(e));case"!=":case"<>":return e=>!t(e).includes(r(e))}}function Je(e){return"string"===typeof e?e.toLowerCase():null!==e&&void 0!==e?e:null}function ze(e){return e?_()(e).valueOf():e}function Ke(e){const{type:t,value:r}=e;let n=r;switch(t.toLowerCase()){case"string":n=Je(r.substring(1,r.length-1));break;case"number":n=Number(r);break;case"boolean":n=Boolean(r);break;case"null":n=null;break;default:n=Je(r)}const a=()=>n;return a.isStaticValue=!0,a}function Ze(e){var t;return null!==(t=e.schema)&&void 0!==t&&t.derived?function(e){if(e.key.includes(".")){const[t,r]=e.key.split("."),n=F({key:r,schema:e.schema});return(e,a)=>{const s={};for(const o of e){const e=o[t];Array.isArray(e)&&e.groupBy(n).forEach((({key:e,values:n})=>{let a=s[e];a||(a={key:e,value:n[0][r],issuesMap:{}},s[e]=a);let i=a.issuesMap[o.issuekey];if(i){const e=i[t];n.forEach((t=>e.push(t)))}else i={...o,[t]:n},a.issuesMap[o.issuekey]=i}))}return Object.values(s).map((({key:e,value:t,issuesMap:r})=>a(t,Object.values(r),e)))}}}(e):function(e){const t=F(e);return(r,n)=>r.groupBy(t).map((({key:t,values:r})=>n(r[0][e.key],r,t)))}(e)}function Ye(e,t,r,n){return t=function(e,t,r){var n;const{id:a,key:s,name:o,headerText:i=o,enableGrouping:l,agrFunc:c,...u}=e,d={id:a,key:s,tagProps:t,headerText:i||o,cellProps:A(e),...u};c&&D(e)&&(d.agrFunc=c);l&&(!r||r.enableGrouping||null!==(n=e.schema)&&void 0!==n&&n.isArray)&&(d.enableGrouping=!0,d.groupFn=Ze(e),d.preGroupFilter=Qe(e.filter));return d}(e,{rowSpan:n},t),r.header[0].push(t),t}function Xe(e,t){const{header:r}=e,[n]=r,a=Z(t,n);e.body=function(e,t=[]){for(const r of e)t.push([]),ne(r,t);return t}(a)}function et(e,t,r,n=-1){if(!e)return[0];n+=1;let a=0;const s=e.length>1,o=e.map((e=>{var o;const i=!e.enableGrouping&&n||null===(o=e.schema)||void 0===o||!o.computed?tt:H,[l,c]=i(e,t,r,n,s,et);return a+=l,c}));return[a,o]}function tt(e,t,r,n,a,s){const{header:o}=t,i=o[n],{key:l,subItems:c,name:u,headerText:d=u,showTotal:p,showTotalFirst:m,...f}=e,h=A(e);if(n||(f.enableGrouping=!0),!f.enableGrouping){const e={key:l,headerText:d,...f,colGroup:!0,depth:n,tagProps:{},cellProps:h};return a?(i.push(e),[1,e]):[0,e]}const y=Qe(e.filter);y&&(r=y(r));const g=p&&{headerText:"Total",colGroup:!0,enableGrouping:!0,depth:n,tagProps:{}};let v=0;const x=[];g&&m&&(i.push(g),x.push(g),v=nt(g,t,c,n,r));const b=Ze(e);let w=0;return b(r,((r,a,o)=>{const u={key:l,...f,colGroup:!0,depth:n,colGroupFn:b,groupFilterFn:P(o),issueFilterFn:E(e,o),value:r,...h,tagProps:{}};i.push(u);const[d,p]=s(c,t,a,n);d&&(u.tagProps.colSpan=d),p&&(u.subItems=p.flat()),w+=d,x.push(u)})),g&&!m&&(i.push(g),x.push(g),v=nt(g,t,c,n,r)),[w?w+v:x.length,x]}function rt(){const{fields:e}=f.getState();return at({subItems:e.filter((e=>e.colGroup)),enableGrouping:!0})}function nt(e,t,r,n,a){const[s,o]=et(r,t,a,n);return s&&(e.tagProps.colSpan=s),o&&(e.subItems=o.flat()),s||1}function at(e,t,r=0,n=1){const{subItems:a,enableGrouping:s,schema:o={}}=e;if(o.computed&&o.depth?r+=o.depth:(s||t)&&(r+=1),null===a||void 0===a||!a.length)return n>r?n:r;const i=a.length>1,l=a.reduce(((e,t)=>at(t,i,r,e)),r);return n>l?n:l}function st(){const{jql:e,fields:t}=f.getState(),r=[];null!==e&&void 0!==e&&e.trim()||r.push("JQL is required to pull issues from Jira"),null!==t&&void 0!==t&&t.length||r.push("No fields selected to generate report");const{fieldsMap:n}=Ge.getState(),a={fieldsMap:n,fields:{},parameters:{}};if(t.forEach(((e,t)=>function(e,t,r,n,a){ot(e,t,r,n,a,e.colGroup)}(e,t,0,r,a))),!r.length)return a;p.setState({reportErrors:r,isFetching:!1},!0)}function ot(e,t,r,n,a,s,o=""){!function(e,t,r,n,a,s){const{name:o,filter:i}=e;if(null!==i&&void 0!==i&&i.trim()){const{isValid:e,errorMessage:r}=ue(i,a);e||n.push(`Field ${s}"${o}" at position ${t+1} has error in filter query: (${r})`)}}(e,t,0,n,a,o),s?function(e,t,r,n,a=""){const{name:s,subItems:o,enableGrouping:i}=e,l=i||!r;l&&(null!==o&&void 0!==o&&o.length||n.push(`Grouping is enabled for field ${a}"${s}" at position ${t+1}, but do not contain row values. Drag and drop the field(s) to be shown as value under "${s}"`),null===o||void 0===o||o.forEach(((e,o)=>ot(e,o,r+1,n,!0,`${a}"${s}" (Position: ${t}) -> `))))}(e,t,r,n,o):function(e,t,r,n){const{id:a,name:s}=e;it.includes(a)&&n.push(`Field "${s}" at position ${t+1} is currently not supported to be used as rows. Convert it to column group instead`)}(e,t,0,n)}const it=["dateRange"];async function lt(){const e=st();if(e&&function({parameters:e}){const{parameters:t={}}=f.getState(),{showParameters:r,parameters:n}=Object.values(e).reduce(((e,r)=>{const n=r.name.toLowerCase();let a=t[n];return a&&a.type===r.type&&a.isArray===r.isArray||(a={name:r.name,type:r.type,isArray:r.isArray}),a.value||(e.showParameters=!0),e.parameters[n]=a,e}),{showParameters:!1,parameters:{}});f.setState({parameters:n}),r&&p.setState({showParameters:!0},!0);return!r}(e)){p.setState({reportErrors:null,isFetching:!0});try{const t=await async function(e){const{jql:t,fields:r}=w(e.fields),{$jira:n}=(0,k.WQ)("JiraService");return(await n.searchTickets(t,r)).map((({id:e,key:t,fields:r})=>function(e){return e.worklog&&(e.worklog=e.worklog.worklogs),e.comment&&(e.comment=e.comment.comments),e}({...r,id:e,issuekey:t})))}(e),r={header:new Array(rt()).fill(null).map((()=>[])),body:[],footer:[]};!function(e,t){const{fields:r}=f.getState(),n=e.header.length;let a;r.forEach((r=>{r.colGroup?et([r],e,t):a=Ye(r,a,e,n)}))}(r,t),Xe(r,t),p.setState({reportData:r,isFetching:!1},!0)}catch(r){let e=["Unknown error occurred while generating report. Look at console log for more details"];var t;if(400===r.status)e=(null===(t=r.error)||void 0===t?void 0:t.errorMessages)||e;console.error("Error generating pivot report:- ",r),p.setState({reportErrors:e,isFetching:!1},!0)}}}async function ct(e){const{id:t}=e,{$report:r}=(0,k.WQ)("ReportService"),n=await r.saveQuery(e,!0);return t!==n&&r.getReportDefinition(n)}var ut=r(9471),dt=r(5767),pt=r(9109);const mt=function(){const e=Ge((({fields:e})=>e));return a.useEffect((()=>{De()}),[]),(0,q.jsxs)("div",{className:"fields-collection",children:[(0,q.jsx)(ft,{}),(0,q.jsx)("div",{className:"fields-group-view",children:e.map((e=>(0,q.jsx)(ht,{fields:e.items,title:e.label},e.label)))})]})};function ft(){const{searchText:e,setSearchText:t}=m();return(0,q.jsxs)("div",{className:"search-container",children:[(0,q.jsx)("span",{className:"fa fa-search"}),(0,q.jsx)(i.fI,{value:e,placeholder:"type here to search for fields...",onChange:t})]})}function ht({fields:e,title:t}){var r,n;const s=null===(r=m((({searchText:e})=>e)))||void 0===r||null===(n=r.trim())||void 0===n?void 0:n.toLowerCase(),[o,l]=a.useState((()=>yt(e,s)));return a.useEffect((()=>{l(yt(e,s))}),[s,e,l]),null!==o&&void 0!==o&&o.length?(0,q.jsxs)("div",{className:"fields-list",children:[(0,q.jsx)("div",{className:"block font-bold",children:t}),o.map(((e,t)=>(0,q.jsxs)(i.sx,{className:"jira-field",itemType:"jira-field",item:e,children:[(0,q.jsx)("span",{className:"fa fa-copy float-end pointer",onClick:t=>function(e,t){var r;(0,u.ds)(e);let n=t.custom?t.name:t.key;n.includes(" ")&&(n=`\`${n}\``);null!==(r=navigator.clipboard)&&void 0!==r&&r.writeText&&navigator.clipboard.writeText(n)}(t,e),title:"Click to copy field for query filter"}),(0,q.jsx)("span",{children:e.name})]},t)))]}):null}function yt(e,t){if(!t)return e;return e.filter((e=>e.name.toLowerCase().includes(t)||e.key.toLowerCase().includes(t)))}function gt({item:e},{index:t}){const r=b(e);f.setState((({fields:e})=>((e=[...e]).splice(t,0,r),{fields:e})))}function vt(e){f.setState((({fields:t})=>((t=[...t]).splice(e,1),{fields:t}))),h.setState({itemPath:null})}function xt(e,t){f.setState((({fields:r})=>((r=[...r])[t]=e,{fields:r})))}function bt(e){f.setState({fields:e})}const wt=function({item:e,index:t,depth:r,dragProps:n}){const s=a.useCallback((e=>{(0,u.ds)(e),vt(t)}),[t]),{itemPath:o,selectItem:i}=h(),l=a.useCallback((()=>i(`fields.${t}`,r)),[t,r,i]);return(0,q.jsx)("div",{className:"row-item"+(o?" selected":""),onClick:l,children:(0,q.jsxs)("div",{className:"row-config-head",ref:n.dragRef,children:[(0,q.jsx)("span",{className:"icon-remove float-end fa fa-times",onClick:s}),(0,q.jsx)("span",{className:"icon fa-solid fa-up-down-left-right"}),e.displayText||e.name]})})};var jt=r(8738),kt=r.n(jt);const Nt=["jira-field"],St=[];function Ct(e){return{...e,subItems:[...e.subItems||[]]}}function Tt({path:e,item:t,depth:r,index:n,dragProps:s,removeItem:l,updateItem:c}){const d=a.useRef();a.useEffect((()=>{d.current={index:n,item:t,updateItem:c}}),[n,t,c]);const[p,m]=(0,o.A)(!0),f=a.useCallback((({itemType:e,item:t},{index:r})=>{"jira-field"===e&&(t=b(t));const{item:n,index:a,updateItem:s}=d.current,o=Ct(n);o.subItems.splice(r,0,t),s(o,a)}),[]),y=a.useCallback((e=>{const{item:t,index:r,updateItem:n}=d.current,a=Ct(t);a.subItems.splice(e,1),n(a,r)}),[]),g=a.useCallback((()=>l(d.current.index)),[l]),v=a.useCallback(((e,t)=>{const{item:r,index:n,updateItem:a}=d.current,s=Ct(r);s.subItems[t]=e,a(s,n)}),[]),x=a.useCallback((e=>{const{item:t,index:r,updateItem:n}=d.current;n({...t,subItems:e},r)}),[]),{itemPath:w,selectItem:j}=h(),k=a.useCallback((t=>{(0,u.ds)(t),j(e,r)}),[e,r,j]),N=0===r||t.enableGrouping,S=kt()("icon-col fa",{pointer:N,"fa-angle-down":N&&p,"fa-angle-right":N&&!p,"fa-arrow-right":!N});return(0,q.jsxs)("div",{className:"col-item"+(w===e?" selected":""),onClick:k,children:[(0,q.jsxs)("div",{className:"col-config-head",ref:s.dragRef,children:[(0,q.jsx)("span",{className:"icon-remove float-end fa fa-times",onClick:g}),N&&(0,q.jsx)("span",{className:"icon-pivot float-end fa-solid fa-table-columns me-2",title:"This field would be pivoted as column"}),(0,q.jsx)("span",{className:S,onClick:m}),t.displayText||t.name]}),p&&N&&(0,q.jsx)(i.L1,{addPlaceholder:!0,className:"sub-items",useDragRef:!0,items:t.subItems||St,accept:Nt,defaultItemType:"col-sub-group",onDrop:f,onChange:x,placeholder:`Drag and drop sub group or value field for ${t.name}`,children:(t,n,{draggable:a})=>(0,q.jsx)(Tt,{path:`${e}.subItems.${n}`,index:n,depth:r+1,item:t,dragProps:a,removeItem:y,updateItem:v},n)})]})}const At=function({...e}){return(0,q.jsx)(Tt,{...e,removeItem:vt,updateItem:xt})};const Ft=function(){return(0,q.jsx)("div",{className:"pivot-config",children:(0,q.jsx)($t,{})})},Et=["jira-field"],Pt=(0,q.jsx)("span",{className:"p-3 block",children:"Drag and drop required fields from list to be shown in report"});function $t(){const e=f((({fields:e})=>e));return(0,q.jsxs)("div",{className:"fields-config",children:[(0,q.jsx)("strong",{children:"Report Fields"}),(0,q.jsx)(i.L1,{placeholder:Pt,useDragRef:!0,items:e,accept:Et,defaultItemType:"row-group",onDrop:gt,onChange:bt,children:(e,t,{draggable:r})=>e.colGroup?(0,q.jsx)(At,{item:e,index:t,dragProps:r,depth:0,path:`fields.${t}`},t):(0,q.jsx)(wt,{index:t,item:e,depth:0,dragProps:r},t)})]})}var It=r(1004);const Rt=[{value:"days",label:"Days with Week"},{value:"week",label:"Week with Month"}];const Lt=function({isRow:e}){const t=Ge((({fields:e})=>e)),r=a.useMemo((()=>t.map((({label:e,items:t})=>({label:e,items:t.filter((e=>{var t,r,n;return(null===(t=e.schema)||void 0===t||null===(r=t.type)||void 0===r?void 0:r.startsWith("date"))&&"date-range"!==(null===(n=e.schema)||void 0===n?void 0:n.type)}))})))),[t]);return(0,q.jsxs)("div",{className:"display-options",children:[(0,q.jsxs)("div",{className:"label-value-pair",children:[(0,q.jsx)("label",{children:"Date Range:"}),(0,q.jsx)("span",{className:"prop-value",children:(0,q.jsx)(It.bZ,{field:"dateRange",range:!0})})]}),!e&&(0,q.jsxs)("div",{className:"label-value-pair",children:[(0,q.jsx)("label",{children:"Range Type:"}),(0,q.jsx)("span",{className:"prop-value",children:(0,q.jsx)(It.wJ,{field:"rangeType",dataset:Rt,autoSelect:!0})})]}),(0,q.jsxs)("div",{className:"label-value-pair",children:[(0,q.jsx)("label",{children:"Filter issues with:"}),(0,q.jsx)("span",{className:"prop-value",children:(0,q.jsx)(It.wJ,{field:"filterField",dataset:r,valueField:"key",optionLabel:"name",optionGroupLabel:"label",optionGroupChildren:"items",filter:!0,grouped:!0})})]})]})},Gt={any:function({item:e,isGrouped:t,isRow:r}){var n,a;const s=!t&&function(e,t){return R.filter((r=>(!r.allowedFor||r.allowedFor.includes(e))&&(t||r.value!==I)))}(null===(n=e.schema)||void 0===n?void 0:n.type,r),o=!t&&((i=e.agrFunc)&&L.includes(i));var i;const l=T[(null===(a=e.schema)||void 0===a?void 0:a.type)||""];return(0,q.jsxs)("div",{className:"display-options",children:[s&&(0,q.jsxs)("div",{className:"label-value-pair",children:[(0,q.jsx)("label",{children:"Function:"}),(0,q.jsx)("span",{className:"prop-value",children:(0,q.jsx)(It.wJ,{field:"agrFunc",dataset:s,autoSelect:!0})})]}),o&&(0,q.jsx)("div",{className:"label-value-pair",children:(0,q.jsx)(It.cG,{field:"useDistinct",label:"Use distinct values only",disabled:!0})}),l&&(0,q.jsxs)("div",{className:"label-value-pair",children:[(0,q.jsx)("label",{children:"Formatting:"}),(0,q.jsx)("span",{className:"prop-value",children:(0,q.jsx)(It.wJ,{field:"format",dataset:l,autoSelect:!0})})]})]})},"date-range":Lt};const Dt=function({filterText:e}){return(0,q.jsxs)("div",{className:"label-value-pair",children:[(0,q.jsx)("label",{children:"Filter Query:"}),(0,q.jsx)(It.r$,{className:"w-100",field:"filter",multiline:!0}),(0,q.jsx)(Mt,{filterText:e})]})};function Mt({filterText:e}){const[t,r]=a.useState({}),n=Ge((e=>e.fieldsMap)),s=a.useRef(n);return s.current=n,a.useEffect((()=>{if(null!==e&&void 0!==e&&e.trim()){const t={fieldsMap:s.current,fields:{},parameters:{}};r(ue(e,t))}else r({})}),[e,r]),t.isValid?null:(0,q.jsx)("div",{className:"msg-error",children:t.errorMessage})}const Ot=function({selection:e}){var t;const{itemPath:r,item:n,isRow:s,level:o,selectItem:l}=e,c=a.useCallback((()=>l()),[l]);if(!n)return null;const u=n.enableGrouping||!s&&0===o,d=Gt[null===(t=n.schema)||void 0===t?void 0:t.type]||Gt.any;return(0,q.jsxs)("div",{className:"item-properties",children:[(0,q.jsx)(i.$n,{icon:"fa fa-times",className:"float-end",onClick:c}),(0,q.jsxs)("div",{className:"label-value-pair",children:[(0,q.jsx)("label",{children:"Field name:"}),(0,q.jsx)("span",{className:"prop-value",children:n.name})]}),(0,q.jsx)(It.lV,{value:n,onChange:y,args:{itemPath:r,isRow:s},children:(0,q.jsxs)("div",{className:"config-props",children:[!o&&(0,q.jsx)(It.cG,{field:"colGroup",label:"Make this a column group field"}),(s||!!o)&&(0,q.jsx)(It.cG,{label:"Enable grouping",field:"enableGrouping"}),(s||!u)&&(0,q.jsxs)("div",{className:"label-value-pair",children:[(0,q.jsx)("label",{children:"Header text"})," ",(0,q.jsx)(It.r$,{field:"headerText",maxLength:35,placeholder:n.name||"Custom header text for column"})]}),u&&(0,q.jsx)(It.cG,{className:"inline-block",label:"Show totals",field:"showTotal"}),u&&(0,q.jsx)(It.zy,{className:"inline-block btn-sm float-end",onLabel:"At start",offLabel:"At end",field:"showTotalFirst",disabled:!n.showTotal}),d&&(0,q.jsx)(d,{item:n,isGrouped:u,isRow:s}),u&&(0,q.jsx)(Dt,{filterText:n.filter})]})})]})};var _t=r(8855),qt=r(6328),Bt=r(8615);const Qt=function({reportId:e}){const t=(0,s.Zp)(),[r,n]=(0,o.A)(!1),l=a.useCallback((async()=>{e?await function(){const{hasChanges:e,...t}=f.getState();return ct(t)}():n()}),[e,n]),c=a.useCallback((()=>{!function(e){const{id:t,queryName:r,createdBy:n}=f.getState();Bt.A.confirmDelete(`Are you sure to delete the report named "${r}" permanently?`).then((()=>{const{$report:a,$message:s,$analytics:o}=(0,k.WQ)("ReportService","MessageService","AnalyticsService");a.deleteSavedQuery(t).then((t=>{s.success(`Pivot report "${r}" deleted successfully`),o.trackEvent("Pivot Report Deleted"),e(n)}))}))}((e=>{t(`/${e}/reports/pivot`)}))}),[t]);return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)("div",{className:"controls float-end",children:[!!e&&(0,q.jsx)(i.$n,{icon:"fa fa-trash",className:"mx-1",severity:"danger",onClick:c,title:"Delete this report"}),(0,q.jsx)(i.$n,{icon:"fa fa-save",className:"mx-1",onClick:l,title:"Save this report"}),!!e&&(0,q.jsx)(i.$n,{icon:"fa fa-copy",className:"mx-1",onClick:n,title:"Rename report or save as new report"})]}),r&&(0,q.jsx)(qt.A,{allowCopy:!!e,onHide:n,onChange:async(e,r)=>{const a=await function(e,t){const{hasChanges:r,...n}=f.getState();return n.queryName=e,t&&delete n.id,ct(n)}(e,r);if(n(),a){const{id:e,createdBy:r}=a;t(`/${r}/reports/pivot/${e}`)}}})]})};const Vt=function({show:e,onHide:t,reportId:r}){const[n,a]=(0,o.A)(!r),s=(0,q.jsx)(Qt,{reportId:r,onToggleDataSource:a});return(0,q.jsx)(pt.A,{show:e,onHide:t,title:"Report Config",onBackClick:n?void 0:a,controls:s,width:"500",contentClassName:"p-0",children:(0,q.jsx)("div",{className:"editor-controls",children:n?(0,q.jsx)(Ut,{onDone:a}):(0,q.jsx)(Wt,{})})})};function Ut({onDone:e}){const{jql:t,dataSourceType:r}=f((({jql:e,dataSourceType:t})=>({jql:e,dataSourceType:t})));return(0,q.jsxs)("div",{className:"p-3",children:[(0,q.jsx)("p",{children:"Select a data source option for retrieving a list of issues. You have the choice of utilizing direct Jira Query Language (JQL) queries or extracting a list of issues based on a specific sprint and subsequently applying a JQL filter to refine the results."}),(0,q.jsx)("label",{className:"font-bold mt-3",children:"Data source type:"}),(0,q.jsx)(dt.a,{className:"block",value:r,defaultValue:1,label:"Use raw JQL to filter and pull issues list",onChange:x}),(0,q.jsx)(dt.a,{className:"block",value:r,defaultValue:2,label:"Pull issues for select sprints and apply JQL filter",onChange:x,disabled:!0}),(0,q.jsx)("label",{className:"font-bold mt-3",children:"JQL Query:"}),(0,q.jsx)(_t.A,{jql:t,plugged:!0,onChange:v}),(0,q.jsx)(i.$n,{className:"float-end me-2",icon:"fa fa-arrow-right",iconPos:"right",label:"Select fields",disabled:2!==r&&(null===t||void 0===t?void 0:t.length)<5,onClick:e,title:"Configure data source"})]})}function Wt(){const e=function(){const{itemPath:e,level:t,selectItem:r}=h(),n=f((t=>e?(0,u.hI)(t,e):null));if(!n)return{};const a=!n.colGroup&&!t;return{item:n,itemPath:e,isRow:a,level:t,selectItem:r}}(),t=!(null===e||void 0===e||!e.item);let r=(0,q.jsxs)("div",{className:"field-config",children:[(0,q.jsx)(Ft,{}),(0,q.jsx)(mt,{})]});return t&&(r=(0,q.jsxs)(ut.O,{style:{height:"100%"},layout:"vertical",children:[(0,q.jsx)(ut.K,{style:{height:"10%"},children:r}),(0,q.jsx)(ut.K,{style:{height:"5%"},children:(0,q.jsx)(Ot,{selection:e})})]})),(0,q.jsx)("div",{className:"controls",children:r})}var Ht=r(1427);const Jt=function(){const e=f((({queryName:e})=>e)),t=p((({reportData:e})=>e));return(0,q.jsx)("div",{className:"group-table-container",children:(0,q.jsxs)(Ht.ew,{className:"group-table table-bordered",exportSheetName:e,children:[(0,q.jsx)(zt,{rows:t.header,tag:Ht.D1,isHeader:!0}),(0,q.jsx)(zt,{rows:t.body,tag:Ht.vc})]})})};function zt({tag:e,isHeader:t,rows:r}){return(0,q.jsx)(e,{children:r.map(((e,r)=>(0,q.jsx)(Kt,{isHeader:t,cells:e},r)))})}function Kt({isHeader:e,cells:t}){return(0,q.jsx)("tr",{children:t.map(((t,r)=>(0,q.jsx)(Zt,{isHeader:e,cell:t},r)))})}function Zt({isHeader:e,cell:t}){const r=e?"th":"td",{value:n,headerText:a,tagProps:s,renderer:{Component:o,props:i}={}}=t;if(o)return(0,q.jsx)(o,{...i,value:n,tag:r,tagProps:s});{const t=(e?a:n)||" ";return(0,q.jsx)(r,{...s,children:t})}}var Yt=r(2813);const Xt=function(){return(0,q.jsx)("div",{className:"pad-15",children:(0,q.jsxs)("section",{children:[(0,q.jsx)("h2",{children:"How to Use the Pivot Report"}),(0,q.jsxs)("ul",{children:[(0,q.jsx)("li",{children:"Start by providing a JQL query to filter data from Jira."}),(0,q.jsx)("li",{children:"Easily customize your report by dragging and dropping fields from the right corner into the Report Fields section."}),(0,q.jsx)("li",{children:"You have the flexibility to display data as regular rows with grouping or mark specific fields as column groups for a column-based layout."}),(0,q.jsx)("li",{children:"Utilize Column Groups to organize and present your data in columns, offering a structured view of your information."}),(0,q.jsx)("li",{children:"Make use of subgroups and filters within column groups to further refine your report's content."}),(0,q.jsx)("li",{children:"To preview your report, simply click on the preview icon located at the top of the report interface."})]}),(0,q.jsxs)("p",{children:["To know more about Pivot report, have a look at ",(0,q.jsx)(i.N_,{href:`${Yt.Jb}/features/reports/pivot`,children:"documentation"})]}),(0,q.jsxs)("p",{children:["To report a bug or suggest improvements to the report, visit ",(0,q.jsx)(i.N_,{href:`${Yt.oq}/discussions/329`,children:"GitHub discussions"})]}),(0,q.jsx)("h2",{children:"Upcoming Enhancements"}),(0,q.jsxs)("ul",{children:[(0,q.jsx)("li",{children:"The ability to sort the data under each group."}),(0,q.jsx)("li",{children:"The ability to display totals for each group, offering a more comprehensive view of your data."}),(0,q.jsx)("li",{children:"Support for utilizing parent, sub-tasks and linked issues, allowing you to explore relationships and dependencies within your data."}),(0,q.jsx)("li",{children:"Enhanced support for pulling issues based on sprints, in addition to JQL queries, for a more dynamic reporting experience."})]}),(0,q.jsx)("h2",{children:"Future Enhancements"}),(0,q.jsxs)("ul",{children:[(0,q.jsx)("li",{children:"Enhanced support for adding the Pivot Report as a gadget on your dashboard, providing seamless integration with your Jira workflow."}),(0,q.jsx)("li",{children:"Exciting new features, including the option to add chart views based on your data, enabling richer data visualization."})]}),(0,q.jsx)("br",{}),(0,q.jsxs)("div",{children:[(0,q.jsxs)("p",{children:[(0,q.jsx)("strong",{children:"Please Note:"})," This report is currently undergoing development and is not yet considered fully operational. We strongly request you to manually validate the output before using it for any business purpose. If you encounter any unexpected errors or if the output does not align with your expectations, we kindly request that you report the issue to us. Your assistance in improving the report's reliability is greatly appreciated."]}),(0,q.jsxs)("p",{children:[(0,q.jsx)("strong",{children:"When reporting issues"}),", we kindly ask you to provide the following details:"]}),(0,q.jsxs)("ol",{children:[(0,q.jsxs)("li",{children:[(0,q.jsx)("strong",{children:"Screenshots:"})," Include screenshots that illustrate the problem or discrepancies you've encountered. Visual aids can significantly assist us in identifying issues."]}),(0,q.jsxs)("li",{children:[(0,q.jsx)("strong",{children:"Console Error Logs:"})," If applicable, please provide any error messages or console logs related to the problem. These logs can offer valuable insights into the root cause of the issue."]}),(0,q.jsxs)("li",{children:[(0,q.jsx)("strong",{children:"Custom Fields:"})," If the issue pertains to specific custom fields, please specify the type of custom fields involved. This information can help us pinpoint and address field-specific challenges more effectively."]})]}),(0,q.jsx)("p",{children:"Your feedback and collaboration are instrumental in ensuring the quality and reliability of this report. We appreciate your patience and assistance as we work to enhance its performance."})]})]})})};const er=function(){const{hasReportData:e,reportErrors:t,isFetching:r,showParameters:n}=p((({reportData:e,reportErrors:t,isFetching:r,showParameters:n})=>({hasReportData:!!e,reportErrors:t,isFetching:r,showParameters:n})));return r?(0,q.jsx)("div",{className:"editor-body p-4",children:(0,q.jsx)("strong",{children:"Please wait while the data is being pulled from Jira. This may take a while depending on the number of issues being pulled."})}):(0,q.jsxs)("div",{className:"editor-body",children:[t&&(0,q.jsx)(tr,{errors:t}),n&&(0,q.jsx)(rr,{}),e&&(0,q.jsx)(Jt,{}),!e&&!n&&(0,q.jsx)(Xt,{})]})};function tr({errors:e}){return(0,q.jsxs)("div",{className:"p-3",children:[(0,q.jsx)("h2",{children:"Report Definition Error"}),(0,q.jsx)("p",{children:"The report definition has one or more errors. Please fix it before you try to generate report"}),(0,q.jsx)("ul",{className:"msg-error",children:e.map(((e,t)=>(0,q.jsx)("li",{children:e},t)))})]})}function rr(){const e=f((({parameters:e})=>e)),t=Object.keys(e);return(0,q.jsx)(It.lV,{value:e,onChange:g,children:(0,q.jsxs)("div",{className:"p-3",children:[(0,q.jsx)("strong",{children:"Provide values for missing parameters to generate report:"}),(0,q.jsx)("br",{}),t.map((t=>(0,q.jsxs)("div",{className:"param-field py-3",children:[(0,q.jsxs)("label",{className:"font-bold me-3",children:[e[t].name,": "]}),(0,q.jsx)(nr,{...e[t]})]},t))),(0,q.jsx)("br",{}),(0,q.jsx)(dt.$n,{icon:"fa fa-refresh",label:"Generate Report",onClick:lt})]})})}function nr({type:e,isArray:t,name:r}){const n=`${r.toLowerCase()}.value`;switch(e){default:return t?(0,q.jsx)(It.QI,{field:n,clearIfEmpty:!0}):(0,q.jsx)(It.r$,{field:n});case"daterange":return(0,q.jsx)(It.bZ,{field:n,range:!0});case"datetime":return(0,q.jsx)(It.bZ,{field:n,showTime:!0});case"date":return(0,q.jsx)(It.bZ,{field:n,showTime:!1});case"usergroup":return(0,q.jsx)("span",{className:"link",children:"Select users"})}}const ar=function({reportId:e,reportType:t,reportPath:r}){const[n,o]=a.useState(),l=(0,s.Zp)();a.useEffect((()=>{(async function(e){const{$report:t}=(0,k.WQ)("ReportService"),r=(await t.getReportsList()).filter((t=>t.reportType===e)).map((e=>({value:e.id,label:e.queryName})));return r})(t).then(o)}),[t]);const c=a.useCallback((e=>{e&&l(`${r}/${e}`)}),[l,r]);return null!==n&&void 0!==n&&n.length?(0,q.jsx)(i.aL,{className:"report-picker",dataset:n,value:parseInt(e),valueField:"value",onChange:c,placeholder:"Select a report to edit"}):null};const sr=function(){const{reportId:e,userId:t}=(0,s.g)(),[r,n]=(0,o.A)(!e);a.useEffect((()=>{!async function(e){if(!e)return f.setState({queryName:"New Report",reportType:"pivot",dataSourceType:1,jql:"",fields:[]},!0),void p.setState({},!0);const{$report:t}=(0,k.WQ)("ReportService"),r=await t.getReportDefinition(e),{$message:n}=(0,k.WQ)("MessageService");r?"pivot"!==r.reportType?(f.setState({queryName:"New Report",reportType:"pivot",dataSourceType:1,jql:"",fields:[]},!0),n.error(`The report "${r.queryName}" is not a valid Pivot Report.`,"Report Incompatible")):f.setState(r,!0):(f.setState({queryName:"New Report",reportType:"pivot",dataSourceType:1,jql:"",fields:[]},!0),n.error(`The report id "${e}" is invalid or the report has been deleted.`,"Report Not Found"))}(e)}),[e]);const c=p((({isFetching:e})=>e)),{queryName:u,parameters:d}=f((({queryName:e,parameters:t})=>({queryName:e,parameters:t}))),m=d&&Object.keys(d).length>0,h=(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(ar,{reportType:"pivot",reportId:e,reportPath:`/${t}/reports/pivot`}),m&&(0,q.jsx)(i.$n,{type:"secondary",icon:"fa fa-list-check",className:"mx-1",onClick:or,title:"Show report parameters"}),(0,q.jsx)(i.$n,{type:"secondary",icon:"fa fa-edit",className:"mx-1",onClick:n,title:"Edit report definition"})]});return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(Vt,{reportId:e,show:r,onHide:n}),(0,q.jsx)("div",{className:"page-container",children:(0,q.jsx)(l.A,{title:u?`${u} - [Pivot report]`:"Pivot report",isGadget:!1,isLoading:c,customActions:h,onRefresh:lt,children:(0,q.jsx)(er,{})})})]})};function or(){p.setState((({showParameters:e})=>({showParameters:!e})))}}}]);